데이터를 처리하는 방식은 자바에서 직접적으로 CRUD를 실행하는 방법도 있지만 업무에서 처리하는 내용이 많은 경우 DB 프로시저를 호출하여 그 업무를 대신하게 합니다.  
1건씩 데이터를 처리하는 경우도 많지만 여러건을 동시에 처리해야 하는 경우도 발생합니다.  
예를 들어 A라는 직원이 B,C,D,E 직원에 대한 직무변경신청을 대신해주었다고 한다면,   
A라는 직원이 B,C,D,E 직원에 대해 각각 한건씩 총 4번의 신청을 할 수도 있지만  
프로그램이 기능을 제공하여 한번에 4명의 직무변경신청이 가능하다고 한다면 1건씩 하지않고 한번에 4건을 신청을 하겠죠.  
  
그래서 최초 신청시 B,C,D,E 신청건에 대해 신청테이블에 저장해놓고, 승인이 나면 이력관리 테이블에 B,C,D,E 4건의 데이터를 입력해주어야 합니다.  
이때 대부분 프로시저를 호출하여 승인 후 처리를 진행하겠죠?  
그런데 프로시저 안에서 시퀀스값을 추가하는 경우 다음과 같이 쿼리를 호출할 경우 에러가 발생합니다.  
  
```
INSERT INTO TBL_이력
(X,Y,Z)
SELECT NVL(MAX(X)+1,0)
     , Y
     , Z
  FROM TBL_신청
 WHERE 신청자=A
   AND 신청서번호=XXX
```
  
제가 프로젝트를 진행하고 있는 곳에서는 NVL과 MAX+1을 활용하여 시퀀스값을 추가시키는데요.   
요녀석 NVL(MAX(X)+1,0) 이 일을 제대로 하려면 한건이 입력이 된 후 커밋이 되고 다시 또 셀렉트를 해야 1,2,3 이런식으로 증가가 됩니다.  
현재 잡고있는 트랜잭션안에서는 죽었다가 깨어나도 NVL(MAX(X)+1,0)이 1,2,3으로 증가할 수 없는거죠.  
그래서 어떻게 해결했냐면 다음과 같이 해결했습니다.  
  
`NVL(MAX(X),0)+ROWNUM  `
  
네. 선택한 행에 ROWNUM을 더해서 시퀀스의 값을 추가시킨거죠.  
거창한 해결법이 있는 것은 아니었고, 간단하게 꼼수아닌 꼼수를 부려 해결을 할 수 있었죠.  
혹시나 같은 문제를 경험하고 있는 분이 계시다면 제가 해결한 방법을 사용해보는건 어떨까요?  
